<main class="h-screen px-4">
    <div class="flex-1">
        <div class="flex flex-row items-center justify-end mb-4 space-x-2 p-2 top-0">
            <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2.2"
            stroke="currentColor"
            class="w-5 h-5  text-black">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
          </svg>
       
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 21 25"
            fill="none"
            class="w-5 h-5 mt-1 text-black">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M2.62501 8.125C2.62501 6.03642 3.4547 4.03338 4.93155 2.55653C6.4084 1.07969 8.41143 0.25 10.5 0.25C12.5886 0.25 14.5916 1.07969 16.0685 2.55653C17.5453 4.03338 18.375 6.03642 18.375 8.125V12.3595L20.4248 16.459C20.5191 16.6477 20.5637 16.8574 20.5542 17.0681C20.5447 17.2789 20.4815 17.4837 20.3706 17.6631C20.2597 17.8426 20.1047 17.9907 19.9205 18.0934C19.7362 18.1961 19.5287 18.25 19.3178 18.25H14.8583C14.608 19.2155 14.0442 20.0706 13.2554 20.681C12.4666 21.2915 11.4974 21.6227 10.5 21.6227C9.50259 21.6227 8.5334 21.2915 7.74459 20.681C6.95578 20.0706 6.39201 19.2155 6.14176 18.25H1.68226C1.4713 18.25 1.26383 18.1961 1.07956 18.0934C0.895295 17.9907 0.740343 17.8426 0.629426 17.6631C0.51851 17.4837 0.45531 17.2789 0.44583 17.0681C0.436351 16.8574 0.480905 16.6477 0.575263 16.459L2.62501 12.3595V8.125ZM8.55151 18.25C8.749 18.592 9.03303 18.876 9.37506 19.0735C9.71709 19.2709 10.1051 19.3749 10.5 19.3749C10.895 19.3749 11.2829 19.2709 11.625 19.0735C11.967 18.876 12.251 18.592 12.4485 18.25H8.55151ZM10.5 2.5C9.00817 2.5 7.57743 3.09263 6.52254 4.14752C5.46765 5.20242 4.87501 6.63316 4.87501 8.125V12.3595C4.87499 12.7086 4.79372 13.053 4.63764 13.3652L3.32139 16H17.6798L16.3635 13.3652C16.207 13.0531 16.1254 12.7087 16.125 12.3595V8.125C16.125 6.63316 15.5324 5.20242 14.4775 4.14752C13.4226 3.09263 11.9919 2.5 10.5 2.5Z"
              fill="currentColor" />
          </svg>
          <img
          src="assets/user-photo.jpg"
          alt="Photo de profil"
          class="h-12 w-12 rounded-full mr-4"
        />
          </div>
      <!-- Section principale -->
      <p class="text-xl font-bold">Gestion des Bilans</p>
      <p class="text-gray-400 text-xs mt-1">Voir et gérer les bilans des patients</p>
      <div class="border-t border-gray-300 mt-4"></div>
      <div class="overflow-x-auto mt-5 h-[70%]">
        <table class="table-auto w-full text-left text-sm text-gray-600">
          <thead>
            <tr class="border-b bg-gray-100">
              <th class="py-2 px-4">NSS</th>
              <th class="py-2 px-4">Date</th>
              <th class="py-2 px-4">Type de Bilan</th>
              <th class="py-2 px-4">Statut</th>
              <th class="py-2 px-4">Actions</th>
            </tr>
          </thead>
          <tbody class="">
            <tr *ngFor="let bilan of paginatedBilans" class="hover:bg-gray-50 space-y-2">
              <td class="py-2 px-4">{{ bilan?.nss }}</td>
              <td class="py-2 px-4">{{ bilan?.date }}</td>
              <td class="py-2 px-4">{{ bilan?.type }}</td>
              <td class="py-2 px-4">
                <span
                class="py-2 text-sm rounded-full text-white font-bold"
                [ngClass]="{
                  'bg-[#2D6974] px-9 ': bilan.status === 'traité',
                  'bg-[#FCC698] px-5 ': bilan.status === 'non traité'
                }"
              >
                {{ bilan.status }}
              </span>
              
              </td>
              <td class="py-2 px-4 flex space-x-2">
                <button *ngIf="bilan.status === 'non traité'" (click)="openPopup(bilan)" >
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.07683 15.0851L8.69108 14.6194L18.4105 4.78355C18.4872 4.70499 18.5298 4.59943 18.5293 4.48966C18.5288 4.37989 18.4851 4.27473 18.4077 4.19689L17.8257 3.60839C17.788 3.56974 17.7431 3.53897 17.6935 3.51787C17.6438 3.49678 17.5905 3.48578 17.5366 3.48553C17.4826 3.48527 17.4292 3.49576 17.3794 3.51638C17.3295 3.53701 17.2843 3.56735 17.2463 3.60564L7.55258 13.4158L7.07683 15.0851ZM18.9779 2.44239L19.56 3.0318C20.363 3.84489 20.3703 5.15664 19.5747 5.96147L9.55916 16.098L6.10883 17.0916C6.00452 17.121 5.89546 17.1294 5.78787 17.1166C5.68028 17.1038 5.57628 17.0699 5.48179 17.0169C5.38731 16.9638 5.30419 16.8927 5.2372 16.8075C5.1702 16.7224 5.12064 16.6249 5.09133 16.5206C5.04637 16.3693 5.04574 16.2083 5.0895 16.0567L6.09325 12.5367L16.0822 2.4268C16.2721 2.23555 16.4982 2.08403 16.7473 1.98108C16.9965 1.87813 17.2636 1.82581 17.5331 1.82717C17.8027 1.82854 18.0692 1.88356 18.3173 1.98903C18.5653 2.0945 18.7899 2.24922 18.9779 2.44239ZM8.41883 3.49931C8.8735 3.49931 9.242 3.87239 9.242 4.33256C9.24272 4.44133 9.222 4.54919 9.18101 4.64995C9.14002 4.75072 9.07958 4.84241 9.00312 4.9198C8.92667 4.99719 8.83572 5.05875 8.73546 5.10096C8.6352 5.14317 8.52761 5.16521 8.41883 5.1658H5.12616C4.21683 5.1658 3.47983 5.91197 3.47983 6.83139V16.8286C3.47983 17.7489 4.21683 18.4951 5.12616 18.4951H15.0042C15.9135 18.4951 16.6514 17.7489 16.6514 16.8286V13.4965C16.6514 13.0363 17.0199 12.6632 17.4746 12.6632C17.9292 12.6632 18.2977 13.0363 18.2977 13.4974V16.8286C18.2977 18.6692 16.8228 20.1616 15.0042 20.1616H5.12616C3.3075 20.1616 1.8335 18.6692 1.8335 16.8286V6.83139C1.8335 4.99164 3.3075 3.49931 5.12616 3.49931H8.41883Z" fill="black"/>
                    </svg>
                </button>
                <button *ngIf="bilan.status === 'traité'" (click)="genererGraphe(bilan)">
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.1667 4.58301V6.41634H17.4167V9.16634H15.5833V6.41634H12.8333V4.58301H15.5833V1.83301H17.4167V4.58301H20.1667ZM17.4167 17.4163H4.58333V4.58301H10.0833V2.74967H4.58333C3.575 2.74967 2.75 3.57467 2.75 4.58301V17.4163C2.75 18.4247 3.575 19.2497 4.58333 19.2497H17.4167C18.425 19.2497 19.25 18.4247 19.25 17.4163V11.9163H17.4167V17.4163ZM13.75 11.9163V15.583H15.5833V11.9163H13.75ZM10.0833 15.583H11.9167V8.24967H10.0833V15.583ZM8.25 15.583V10.083H6.41667V15.583H8.25Z" fill="black"/>
                    </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      
       


            <!-- Pagination -->
            <div class="grid grid-cols-3 mt-9 self-center justify-items-center fixed bottom-4 w-[80%]">

                    <button
                    class="text-md text-gray-600   "
                    [disabled]="currentPage === 1"
                    (click)="changePage(currentPage - 1)"
                    >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6 ">
                        <path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                    </svg>                      
                    </button>
                <div class=" space-x-2">
                    <button
                        *ngFor="let page of [].constructor(Math.ceil(bilans.length / itemsPerPage)); let i = index"
                        (click)="changePage(i + 1)"
                        [class.bg-[#2D6974]]="currentPage === i + 1"
                        [class.text-white]="currentPage === i + 1"
                        class="px-3 py-1 rounded-md "
                    >
                        {{ i + 1 }}
                    </button>
                </div>
                <button
                    class=" text-gray-600 text-md  "
                    [disabled]="currentPage === Math.ceil(bilans.length / itemsPerPage)"
                    (click)="changePage(currentPage + 1)"
                    >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                        <path fill-rule="evenodd" d="M12.97 3.97a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 1 1-1.06-1.06l6.22-6.22H3a.75.75 0 0 1 0-1.5h16.19l-6.22-6.22a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                    </svg>
                    
                </button>
            </div> 
            <!-- Popup -->
            <div
            *ngIf="popupVisible"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
            >
            <div class="bg-gray-100 p-6 rounded-lg shadow-lg w-[90%] md:w-[50%] relative">
            <!-- Titre et bouton fermer -->
            <div class="flex flex-row justify-between items-baseline">
                <p class="text-xl font-bold mb-4">Remplir Bilan</p>
                <button (click)="closePopup()" class="text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                    <path
                    fill-rule="evenodd"
                    d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z"
                    clip-rule="evenodd"
                    />
                </svg>
                </button>
            </div>
            <div class="border-t border-gray-300"></div>

            <!-- Informations personnelles -->
            <div class="mt-4">
                <div class="flex flex-row justify-start items-center mt-6">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5 mr-2">
                        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
                    </svg>
                    <p class="font-bold text-sm ">Informations personnelles</p>

                </div>
                <p class="mt-4 ml-4"><strong>NSS : </strong> {{ selectedBilan?.nss }}</p>
                <p class="mt-4 ml-4"><strong>Date : </strong> {{ selectedBilan?.date }}</p>
            </div>

            <!-- Résultats -->
            <div class="mt-6">
                <div class="flex flex-row justify-start items-center mt-6">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5 mr-2 mb-2">
                        <path fill-rule="evenodd" d="M10.5 3.798v5.02a3 3 0 0 1-.879 2.121l-2.377 2.377a9.845 9.845 0 0 1 5.091 1.013 8.315 8.315 0 0 0 5.713.636l.285-.071-3.954-3.955a3 3 0 0 1-.879-2.121v-5.02a23.614 23.614 0 0 0-3 0Zm4.5.138a.75.75 0 0 0 .093-1.495A24.837 24.837 0 0 0 12 2.25a25.048 25.048 0 0 0-3.093.191A.75.75 0 0 0 9 3.936v4.882a1.5 1.5 0 0 1-.44 1.06l-6.293 6.294c-1.62 1.621-.903 4.475 1.471 4.88 2.686.46 5.447.698 8.262.698 2.816 0 5.576-.239 8.262-.697 2.373-.406 3.092-3.26 1.47-4.881L15.44 9.879A1.5 1.5 0 0 1 15 8.818V3.936Z" clip-rule="evenodd" />
                    </svg>
                    
                    
                    <p class="font-bold text-sm mb-2">Résultats</p>
                </div>
                <div class="max-h-48 overflow-y-auto">
                    <div *ngFor="let test of tests; let i = index" class="flex space-x-4 mb-2 max-h-10 overflow-y- ml-4">
                        <input
                        type="text"
                        [(ngModel)]="test.nom"
                        placeholder="Nom du test"
                        class="border border-gray-300 rounded-xl p-2 w-1/4"
                        />
                        <input
                        type="text"
                        [(ngModel)]="test.valeur"
                        placeholder="Valeur"
                        class="border border-gray-300 rounded-xl p-2 w-1/4"
                        />
                        <input
                        type="text"
                        [(ngModel)]="test.unite"
                        placeholder="Unité"
                        class="border border-gray-300 rounded-xl p-2 w-1/4"
                        />
                        <button
                        (click)="removeTest(i)"
                        
                        >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                        <path fill-rule="evenodd" d="M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z" clip-rule="evenodd" />
                        </svg>
                        
                        </button>
                    </div>
                </div>
                
                <button       
                        (click)="addTest()"
                        class="  flex flex-row items-center justify-center text-sm font-semibold   text-black ml-4">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="black" class="size-4 mr-2 mt-1 ">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                            
                            Ajouter un Test 
                </button>
                
            </div>

            <!-- Boutons -->
            <div class="flex flex-row justify-end items-end space-x-2  mt-4">
                <button 
                (click)="closePopup()"      
                class="px-12 py-3 bg-white flex flex-row items-center justify-center rounded-full text-sm font-bold   text-black">                      
                Annuler  
            </button>
                <button  
                (click)="saveResults()"
                class="px-12 py-3 bg-[#2D6974]  rounded-full text-sm font-bold   text-white">                      
                    Enregistrer  
                </button>
            
            </div>


            </div>
            </div>
      
    
        </div>
    </div>
</main>
  